import { ArgsTable, Canvas, Meta, Story } from '@storybook/addon-docs';
import { HIDDEN_COMMON_PROPS, VARIANT } from '../helpers';
import {
  Card,
  Button,
  CardGroup,
  Row,
  Col,
  Form,
  InputGroup,
  FormControl,
  CloseButton,
  SelectableCard,
  QuantityToggle,
} from '../../src/components/index';
import { useState, useRef, useEffect } from 'react';
import { CARD_COMMON_PROPS } from './argTypes';

<Meta
  title="MDX/Card/Action Card/Selectable"
  component={SelectableCard}
  argTypes={{
    ...HIDDEN_COMMON_PROPS,
    ...CARD_COMMON_PROPS,
    disabled: {
      description: 'Disables the FormCheck when true',
    },
    type: { description: 'The type of checkable' },
  }}
/>

export const AppleBody = (
  <>
    <Card.Subtitle as="h6" className="text-muted">
      <i className="bi bi-box"></i>Laptop
    </Card.Subtitle>
    <Card.Title as="h4">
      Apple <i className="bi bi-apple"></i>
    </Card.Title>
    <Card.Text>Macbook Pro M1</Card.Text>
  </>
);

export const MicrosoftBody = (
  <>
    <Card.Subtitle as="h6" className="text-muted">
      <i className="bi bi-box"></i>Laptop
    </Card.Subtitle>
    <Card.Title as="h4">
      Microsoft <i className="bi bi-microsoft"></i>
    </Card.Title>
    <Card.Text>Microsoft Surface Pro</Card.Text>
  </>
);

export const AcerBody = (
  <>
    <Card.Subtitle as="h6" className="text-muted">
      <i className="bi bi-box"></i>Laptop
    </Card.Subtitle>
    <Card.Title as="h4">
      Acer <i className="bi bi-laptop"></i>
    </Card.Title>
    <Card.Text>Acer Aspire 5</Card.Text>
  </>
);

export const ExampleTemplate = (args) => {
  const [brand, setBrand] = useState('');
  const [qty, setQty] = useState(-2);
  const [disappear, setDisappear] = useState(false);
  const handleChange = (e) => {
    setBrand(e.target.value);
  };
  const handleDismiss = () => {
    //do side effects to handleDimiss
    setBrand('');
    setQty(1);
    setDisappear(!disappear);
  };
  const handleSubmit = () => {
    alert(`Order submitted: ${brand} laptop x${qty}`);
    setBrand('');
    setQty(1);
  };
  return (
    <Row>
      <Col xs lg="4">
        <Form>
          <SelectableCard
            name="test"
            type="radio"
            value="apple"
            onChange={handleChange}
            checked={brand === 'apple'}
          >
            {AppleBody}
          </SelectableCard>
          <SelectableCard
            name="test"
            type="radio"
            value="microsoft"
            onChange={handleChange}
            checked={brand === 'microsoft'}
          >
            {MicrosoftBody}
          </SelectableCard>
          <SelectableCard
            name="test"
            type="radio"
            value="acer"
            onChange={handleChange}
            checked={brand === 'acer'}
          >
            {AcerBody}
          </SelectableCard>
        </Form>
      </Col>
      <Col xs lg="5">
        {brand && (
          <Card variant="card-action-quantity-toggle">
            <Card.Body>
              <div>
                <Card.Title as="h4">
                  Basket <i className="bi bi-cart"></i>
                </Card.Title>
                <CloseButton onClick={handleDismiss} />
              </div>
              <div>
                <Card.Unit>
                  <Card.Subtitle as="h6" className="text-muted">
                    Item Brand
                  </Card.Subtitle>
                  <Card.Subtitle as="h6">{brand}</Card.Subtitle>
                </Card.Unit>
                <QuantityToggle count={qty} setCount={setQty} />
              </div>
            </Card.Body>
            <Button onClick={handleSubmit}>Submit</Button>
          </Card>
        )}
      </Col>
    </Row>
  );
};

# Action Card

Action Cards are Cards that are able to perform actions like selection or quantity toggling. Usually with built-in input elements.

## `<SelectableCard />`

`<SelectableCard />` are Cards with input checkbox , radio or switch functionalities.
`<SelectableCard />` is a composite component built with `<Card />` and `<FormCheck />` with partially extended props from both Components.
Like `<Card />`, it is a wrapper that accepts subcomponents of `Card` as children.

The `ref` of `<FormCheck />` is extended to the `<Card/>` making the entire `<SelectableCard/>` essentially an input

### Default

The default SelectableCard is a checkbox.

<Canvas>
  <Story name="Default SelectableCard">
    {(args) => (
      <Row>
        <Col xs>
          <SelectableCard {...args}>{AppleBody}</SelectableCard>
        </Col>
        <Col xs>
          <></>
        </Col>
        <Col xs>
          <></>
        </Col>
      </Row>
    )}
  </Story>
</Canvas>

## API

<ArgsTable story="Default SelectableCard" />

`SelectableCard` partially extends `FormCheckProps`, `CardProps` and extends their HTMLAttributes. The resulting props are as indicated in ArgsTable above.

### Types

Use `type` prop : `radio` / `switch` / `checkbox` to change the `SelectableCard` input type

<Canvas>
  <Story name="Types">
    {() => (
      <Row>
        <Col xs>
          <SelectableCard type="checkbox">{AppleBody}</SelectableCard>
        </Col>
        <Col xs>
          <SelectableCard type="radio">{AppleBody}</SelectableCard>
        </Col>
        <Col xs>
          <SelectableCard type="switch">{AppleBody}</SelectableCard>
        </Col>
      </Row>
    )}
  </Story>
</Canvas>

## Usage: Shopping Cart

An example of the usage of the `<SelectableCard />` with a Custom Basket card with `<QuantityToggle />`

Click on the `SelectableCard` to choose your product to order

<Canvas>
  <Story name="Usage Example">{ExampleTemplate.bind({})}</Story>
</Canvas>

### Shopping Cart Code

```jsx
import {
  SelectableCard,
  Form,
  Col,
  Row,
  QuantityToggle,
  Card,
} from 'sgds-react';
import { useState } from 'react';

export const ShoppingCart = (args) => {
  const [brand, setBrand] = useState('');
  const [qty, setQty] = useState(1);
  const [disappear, setDisappear] = useState(false);
  const handleChange = (e) => {
    setBrand(e.target.value);
  };
  const handleDismiss = () => {
    //do side effects to handleDimiss
    setBrand('');
    setQty(1);
    setDisappear(!disappear);
  };
  const handleSubmit = () => {
    alert(`Order submitted: ${brand} laptop x${qty}`);
    setBrand('');
    setQty(1);
  };
  return (
    <Row>
      <Col xs lg="4">
        <Form>
          <SelectableCard
            name="test"
            type="radio"
            value="apple"
            checked={brand === 'apple'}
            onChange={handleChange}
          >
            {AppleBody}
          </SelectableCard>
          <SelectableCard
            name="test"
            type="radio"
            value="microsoft"
            checked={brand === 'microsoft'}
            onChange={handleChange}
          >
            {MicrosoftBody}
          </SelectableCard>
          <SelectableCard
            name="test"
            type="radio"
            value="acer"
            checked={brand === 'acer'}
            onChange={handleChange}
          >
            {AcerBody}
          </SelectableCard>
        </Form>
      </Col>
      <Col xs lg="4">
        {brand && (
           <Card variant="card-action-quantity-toggle">
            <Card.Body>
              <div>
                <Card.Title as="h4">
                  Basket <i className="bi bi-cart"></i>
                </Card.Title>
                <CloseButton onClick={handleDismiss} />
              </div>
              <div>
                <Card.Unit>
                  <Card.Subtitle as="h6" className="text-muted">
                    Item Brand
                  </Card.Subtitle>
                  <Card.Subtitle as="h6">{brand}</Card.Subtitle>
                </Card.Unit>
                <QuantityToggle count={qty} setCount={setQty} />
              </div>
            </Card.Body>
            <Button onClick={handleSubmit}>Submit</Button>
          </Card>
        )}
      </Col>
    </Row>
  );
};
```
