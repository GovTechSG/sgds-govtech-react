import { ArgsTable, Canvas, Meta, Story } from '@storybook/addon-docs';
import {
  Button,
  Stepper,
  Form,
  useStep,
  Row,
  Col,
} from '../../src/components/index';
import { useState } from 'react';

<Meta title="MDX/Stepper" component={Stepper} />

export const Template = () => {
  const initialState = {
    firstName: '',
    lastName: '',
    gender: '',
    email: '',
    address: '',
  };
  const [submitted, setSubmitted] = useState(false);
  const [details, setDetails] = useState(initialState);
  const handleChange = (e) => {
    setDetails({ ...details, [e.target.name]: e.target.value });
  };
  const ComponentOne = (
    <>
      <Form.Group className="mb-3" controlId="formBasicFirstName">
        <Form.Label>First Name</Form.Label>
        <Form.Control
          type="text"
          placeholder="Enter first name"
          name="firstName"
          onChange={handleChange}
          value={details.firstName}
        />
      </Form.Group>
      <Form.Group className="mb-3" controlId="formBasicLastName">
        <Form.Label>Last Name</Form.Label>
        <Form.Control
          type="text"
          placeholder="Enter last name"
          name="lastName"
          onChange={handleChange}
          value={details.lastName}
        />
      </Form.Group>
      <Form.Group className="mb-3" controlId="formBasicCheckbox">
        <Form.Check
          type="radio"
          name="gender"
          value="female"
          label="Female"
          inline
          onChange={handleChange}
          checked={details.gender === 'female'}
        />
        <Form.Check
          type="radio"
          name="gender"
          value="male"
          label="Male"
          inline
          onChange={handleChange}
          checked={details.gender === 'male'}
        />
      </Form.Group>
    </>
  );
  const ComponentTwo = (
    <>
      <Form.Group className="mb-3" controlId="formEmail">
        <Form.Label>Email</Form.Label>
        <Form.Control
          type="email"
          placeholder="Enter email"
          name="email"
          onChange={handleChange}
          value={details.email}
        />
      </Form.Group>
      <Form.Group className="mb-3" controlId="formBasicLastName">
        <Form.Label>House Address</Form.Label>
        <Form.Control
          type="text"
          placeholder="House address e.g Blk 24 Seng Kang Way #02-05"
          name="address"
          onChange={handleChange}
          value={details.address}
        />
      </Form.Group>
    </>
  );
  const ComponentThree = (
    <>
      <Form.Group className="mb-3" controlId="formBasicFirstName">
        <Form.Label>First Name</Form.Label>
        <Form.Control
          type="text"
          value={details.firstName}
          name="firstName"
          plaintext
          readOnly
        />
      </Form.Group>
      <Form.Group className="mb-3" controlId="formBasicLastName">
        <Form.Label>Last Name</Form.Label>
        <Form.Control
          type="text"
          name="lastName"
          value={details.lastName}
          plaintext
          readOnly
        />
      </Form.Group>
      <Form.Group className="mb-3" controlId="formBasicCheckbox">
        <Form.Check
          type="radio"
          name="gender"
          value="female"
          label="Female"
          inline
          checked={details.gender === 'female'}
          readOnly
        />
        <Form.Check
          type="radio"
          name="gender"
          value="male"
          label="Male"
          inline
          checked={details.gender === 'male'}
          readOnly
        />
      </Form.Group>
      <Form.Group className="mb-3" controlId="formEmail">
        <Form.Label>Email</Form.Label>
        <Form.Control
          type="email"
          name="email"
          readOnly
          value={details.email}
          plaintext
        />
      </Form.Group>
      <Form.Group className="mb-3" controlId="formBasicLastName">
        <Form.Label>House Address</Form.Label>
        <Form.Control
          type="text"
          name="address"
          readOnly
          value={details.address}
          plaintext
        />
      </Form.Group>
    </>
  );
  const stepMethods = useStep([
    {
      component: ComponentOne,
      title: 'Personal Details',
      stepHeader: 'Personal Details',
      onNextStep: async (onDone) => {
        onDone();
      },
      onArrived: async () => console.log('onArrived1'),
    },
    {
      component: ComponentTwo,
      title: 'Address and Contact Information',
      stepHeader: 'Address and Contact Information',
      onNextStep: async (onDone) => {
        onDone();
      },
      onPreviousStep: async (onDone) => {
        onDone();
      },
      onArrived: async () => console.log('onArrived2'),
    },
    {
      component: ComponentThree,
      title: 'Create project',
      stepHeader: 'Review',
      onPreviousStep: async (onDone) => {
        onDone();
      },
      onArrived: async () => console.log('onArrived3 '),
    },
  ]);
  const {
    state: stepState,
    stepsMetadata,
    getTitle,
    setStep,
    nextStep,
    prevStep,
    getNextButtonTitle,
    getBackButtonTitle,
    getComponent,
    reset,
  } = stepMethods;
  const resetForm = () => {
    setDetails(initialState);
    reset();
  };
  const submit = () => {
    alert('Form Submitted');
    setSubmitted(true);
  };
  return (
    <>
      {submitted ? (
        <div>Submitted!</div>
      ) : (
        <>
          <Stepper methods={stepMethods} />
          <Form className="p-3">
            <div>{getComponent()}</div>
            <div className="d-flex justify-content-between">
              <div>
                {getBackButtonTitle() && (
                  <Button onClick={prevStep} variant="danger" className="me-3">
                    {getBackButtonTitle()}
                  </Button>
                )}
                <Button onClick={resetForm} variant="secondary">
                  Reset
                </Button>
              </div>
              <div>
                <Button
                  onClick={
                    stepsMetadata.isLastStep(stepState.currentStep)
                      ? submit
                      : nextStep
                  }
                >
                  {' '}
                  {getNextButtonTitle()}
                </Button>
                <Button
                  className="ms-3"
                  onClick={() => setStep(3)}
                  variant="warning"
                >
                  Jump to last page
                </Button>
              </div>
            </div>
          </Form>
        </>
      )}
    </>
  );
};

# Stepper

Stepper informs users which step they are in a form or process.
Each step markers indicate the stage of the process.

<Canvas>
  <Story name="example">{Template.bind({})}</Story>
</Canvas>

## Usage

### 1. `useStep` hook

`<Stepper /> ` takes in a `methods` prop of type `UseStepMethods` which can be generated from a custom hook `useStep`.

Import `useStep` hook from `sgds-govtech-react`

```jsx
import { useStep } from 'sgds-govtech-react';
```

### 2. `StepMetadata`

`useStep` hook takes in an array of objects of type `StepMetadata`. Each `StepMetadata` controls each step of the Stepper in ascending order of its index position in the array.
See API for `StepMetadata`

```jsx
import { useStep, StepMetadata, Stepper } from 'sgds-govtech-react'

const ExampleStepper = () => {
  const metadata : StepMetadata[] = [
    {
      component: ComponentOne,
      title: 'Personal Details',
      stepHeader: 'Personal Details',
      onNextStep: async (onDone) => {
        onDone();
      },
      onArrived: async () => console.log('onArrived'),
    },
    {
      component: ComponentTwo,
      title: 'Address and Contact Information',
      stepHeader: 'Address and Contact Information',
      onNextStep: async (onDone) => {
        onDone();
      },
      onPreviousStep: async (onDone) => {
        onDone();
      },
      onArrived: async () => console.log('onArrived2'),
    },
    {
      component: ComponentThree,
      title: 'Create project',
      stepHeader: 'Review',
      onNextStep: async (onDone) => {
        console.log('submit action ');
        return history.push('/')
      },
      onPreviousStep: async (onDone) => {
        onDone();
      },
      onArrived: async () => console.log('onArrived3 '),
    },
  ];

  const stepMethods = useStep(metadata)
  ...
}

```

- `component` controls the content to be rendered in each stage of the stepper. `component` can be a React component, HTML element, string etc.

- `title` can be used to render the title of each stepper process. `title` can be a React component, HTML element, string etc.

- `stepHeader` determines the step-detail of each step-marker. `stepHeader` is a string

When side-effects like updating store and states are required, specify them in `onNextStep`, `onPrevious` or `onArrived`.

- `onNextStep` specifies side-effects before the next component is rendered.

- `onPreviousStep` specifies any side-effects before previous component is rendered.

- `onArrived` specifies any side-effects after the component is rendered

`onNextStep`, `onPreviousStep` and `onArrived` are optional.

`onNextStep`, `onPreviousStep` runs OnDone() by default when triggered.

When specifying `onPreviousStep` or `onNextStep`,`OnDone` must be specified after any side-effects to proceed to the previous stage.

```js
interface StepMetadata {
  component: any;
  title: any;
  stepHeader: string;
  onNextStep?: (onDone: OnDone) => Promise<void>;
  onPreviousStep?: (onDone: OnDone) => Promise<void>;
  onArrived?: () => Promise<void>;
}
```

### 3. `UseStepMethods`

`useStep` hook generates the object of type `UseStepMethods`

```jsx
import { useStep, StepMetadata, Stepper, UseStepMethods } from 'sgds-govtech-react'

const ExampleStepper = () => {
  const metadata : StepMetadata[] = [...];

  const stepMethods: UseStepMethods = useStep(metadata)

  return(
    <Stepper methods={stepMethods}>
  )
}

```

Destructure the returned object of `stepMethods` to access the various step methods

```jsx
import { useStep, StepMetadata, Stepper } from 'sgds-govtech-react'

const ExampleStepper = () => {
  const metadata : StepMetadata[] = [...];

  const stepMethods = useStep(metadata)

  const {
      state,
      stepsMetdata,
      getTitle,
      setStep,
      nextStep,
      prevStep,
      getNextButtonTitle,
      getBackButtonTitle,
      getComponent,
      reset,
    } = stepMethods;

  return(
    <Stepper methods={stepMethods}>
  )
}
```

```js
interface UseStepMethods {
  state: StepperState;
  stepsMetadata: WrappedStepsMetadata;
  nextStep: () => Promise<void>;
  prevStep: () => Promise<void>;
  setStep: (step: number) => Promise<void>;
  getTitle: () => string;
  getComponent: () => any;
  getNextButtonTitle: () => string;
  getBackButtonTitle: () => string | null;
  reset: () => Promise<void>;
}
```

- `getNextButtonTitle` & `getBackButtonTitle` , `getTitle` render the titles of next & back button or component titles when required.

- `getNextButtonTitle` returns 'Submit' instead of 'Next' on the last step

- `prevStep`, `nextStep` performs the side-effects previously specified in `onPreviousStep` and `onNextStep`.

- `setStep` accepts a step number argument and updates the currentStep state of Stepper.

- `reset` resets the Stepper back to stage 1

- `getComponent` renders the specified components for each step.

  Refer to API for more details on each method

```jsx
...
    const submit = () => {
      alert('Form Submitted')
      setSubmitted(true)
  }

  const {
        state: stepState,
        stepsMetdata,
        getTitle,
        setStep,
        nextStep,
        prevStep,
        getNextButtonTitle,
        getBackButtonTitle,
        getComponent,
        reset,
      } = stepMethods;

  return (
    <>
      <Stepper methods={stepMethods} />
      <Form className="p-3">
        <div>{getComponent()}</div>
        <div className="d-flex justify-content-between">
          <div>
            {getBackButtonTitle() && (
              <Button onClick={prevStep} variant="danger" className="me-3">
                {getBackButtonTitle()}
              </Button>
            )}
            <Button onClick={resetForm} variant="secondary">
              Reset
            </Button>
          </div>
          <div>
            <Button onClick={stepsMetadata.isLastStep(stepState.currentStep) ? submit : nextStep}> {getNextButtonTitle()}</Button>
            <Button
              className="ms-3"
              onClick={() => setStep(3)}
              variant="warning"
            >
              Jump to last page
            </Button>
          </div>
        </div>
      </Form>
    </>
  );
```


## API